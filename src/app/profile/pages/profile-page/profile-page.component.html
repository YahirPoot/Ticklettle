<div class="p-8 w-full min-h-screen text-base-content">

<!-- ======================= SKELETON ======================= -->

@if (profileUser.isLoading()) {

    <!-- Skeleton: Título -->
    <div class="w-1/3 skeleton h-10 mb-8"></div>

    <!-- Skeleton: Card de foto + nombre -->
    <div class="card bg-base-200 shadow-xl p-6 mb-8">
        <div class="flex items-start gap-6">

            <!-- Foto -->
            <div class="w-24 h-24 skeleton rounded-full"></div>

            <div class="flex-1 min-w-0 space-y-3">
                <div class="skeleton h-6 w-1/2"></div>
                <div class="skeleton h-4 w-1/3"></div>
            </div>

            <div class="w-32 h-8 skeleton rounded-lg"></div>
        </div>
    </div>

    <!-- Skeleton: Datos Personales Grid -->
    <section class="mb-8">
        <div class="skeleton h-6 w-40 mb-4"></div>

        <div class="bg-base-200 p-6 rounded-xl grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">

            <div class="space-y-2">
                <div class="skeleton h-4 w-24"></div>
                <div class="skeleton h-10 w-full rounded-lg"></div>
            </div>

            <div class="space-y-2">
                <div class="skeleton h-4 w-28"></div>
                <div class="skeleton h-10 w-full rounded-lg"></div>
            </div>

            <div class="space-y-2">
                <div class="skeleton h-4 w-20"></div>
                <div class="skeleton h-10 w-full rounded-lg"></div>
            </div>

            <div class="space-y-2">
                <div class="skeleton h-4 w-40"></div>
                <div class="skeleton h-10 w-full rounded-lg"></div>
            </div>

        </div>
    </section>

    <!-- Skeleton: Casas organizadoras -->
    <section class="mb-8">
        <div class="skeleton h-6 w-52 mb-4"></div>

        <div class="space-y-3">
            <div class="card bg-base-100 p-4 rounded-lg shadow-sm skeleton h-24"></div>
            <div class="card bg-base-100 p-4 rounded-lg shadow-sm skeleton h-24"></div>
            <div class="card bg-base-100 p-4 rounded-lg shadow-sm skeleton h-24"></div>
        </div>
    </section>

    <!-- Skeleton: Navegación Rápida -->
    <section>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <div class="skeleton h-14 w-full rounded-lg"></div>
            <div class="skeleton h-14 w-full rounded-lg"></div>
            <div class="skeleton h-14 w-full rounded-lg"></div>
            <div class="skeleton h-14 w-full rounded-lg"></div>

        </div>
    </section>

} @else {

<!-- ======================= CONTENIDO REAL ======================= -->

    <h1 class="text-3xl font-bold mb-8">Perfil de Usuario</h1>

    <!-- Sección Superior: Info y Eliminar Cuenta -->
    <div class="card bg-base-200 shadow-xl p-6 mb-8 relative">
        <div class="flex items-start gap-6">
            <!-- Imagen de Perfil -->
            <div class="avatar avatar-online">
                <div class="w-24 rounded-full bg-base-300">
                    @if (profileUser.value()?.user?.photoUrl) {
                        <img [src]="profileUser.value()?.user?.photoUrl" class="w-full h-full object-cover 0" />
                    } @else {
                        
                        <!-- <div class="flex items-center justify-center h-full font-bold text-base-content uppercase text-lg">
                            {{ profileUser.value()?.user?.firstName?.charAt(0) }}
                        </div> -->
                        <div class="w-full h-full object-cover flex items-center justify-center font-bold text-base-content uppercase text-lg">
                            <h1>{{ profileUser.value()?.user?.firstName?.charAt(0) }}</h1>
                        </div>
                    }
                </div>
            </div>

            <!-- Nombre y Ubicación -->
            <div class="flex-1 min-w-0">
                <h2 class="text-xl font-bold">{{ profileUser.value()?.user?.firstName }} </h2>
                <div class="flex items-center gap-1 text-sm text-gray-500">
                    <mat-icon class="text-base">location_on</mat-icon>
                    @if (profileUser.value()?.user?.customRole == 1) {
                        <span>Organizador</span>
                    } @else {
                        <span>Asistente</span>
                    }
                </div>
            </div>

            <!-- Botón Eliminar Cuenta -->
            <button class="btn btn-ghost btn-sm text-red-500 hover:bg-red-500/10 shrink-0">
                <mat-icon class="text-lg">delete</mat-icon>
                Eliminar Cuenta
            </button>

        </div>
    </div>
    
    <!-- Sección 2: Datos Personales -->
    <section class="mb-8">
        <h3 class="text-lg font-semibold mb-4 border-b pb-2">Datos Personales</h3>

        <div class="bg-base-200 p-6 rounded-xl grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">

            <!-- Nombre -->
            <div class="space-y-1">
                <label class="text-sm font-medium">Nombre</label>
                <input 
                    type="text" 
                    [value]="profileUser.value()?.user?.firstName" 
                    class="input w-full bg-base-300 border-none focus:outline-none" 
                    readonly
                />
            </div>

            <!-- Apellido -->
            <div class="space-y-1">
                <label class="text-sm font-medium">Apellido</label>
                <input 
                    type="text" 
                    [value]="profileUser.value()?.user?.lastName" 
                    class="input w-full bg-base-300 border-none focus:outline-none" 
                    readonly
                />
            </div>

            <!-- Correo -->
            <div class="space-y-1">
                <label class="text-sm font-medium">Correo</label>
                <input 
                    type="email" 
                    [value]="profileUser.value()?.user?.email" 
                    class="input w-full bg-base-300 border-none focus:outline-none" 
                    readonly
                />
            </div>

            <!-- Fecha de creación -->
            <div class="space-y-1">
                <label class="text-sm font-medium">Fecha de Creación: </label>
                <input 
                    type="text" 
                    [value]="profileUser.value()?.user?.createdAt | date: 'longDate'" 
                    class="input w-full bg-base-300 border-none focus:outline-none" 
                    readonly
                />
            </div>

        </div>
    </section>

    <!-- Sección Organizing Houses -->
    @if (profileUser.value()?.user?.customRole == 1) {
        <section class="mb-8">
            <h3 class="text-lg font-semibold mb-4 border-b pb-2">Casas organizadoras</h3>

            <div class="space-y-3">
                @if (profileUser.value()?.organizingHouses?.length === 0) {
                    <div class="text-sm text-neutral">No hay casas organizadoras asociadas a este perfil.</div>
                }

                @for (house of profileUser.value()?.organizingHouses; track house.organizingHouseId) {
                    <div class="card bg-base-100 p-4 rounded-lg shadow-sm">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <div class="font-semibold truncate">{{ house.name }}</div>
                                <div class="text-sm text-base-content/50 mt-1">Dirección: {{ house.address }}</div>
                                <div class="text-sm text-base-content/50 mt-1">Contacto: {{ house.contact }}</div>
                                <div class="text-sm text-base-content/50 mt-1">Datos fiscales: {{ house.taxData || 'N/D' }}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500 mt-2">ID: {{ house.organizingHouseId }}</div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </section>
    }

    <!-- Navegación rápida (Asistente) -->
    @if (role === 'Asistente') {
        <section>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                <a [routerLink]="['/profile-user', 'payments']" class="p-4 border-b border-gray-300 hover:border-primary transition-all duration-200 flex justify-between items-center group">
                    <span class="text-base font-medium">Métodos de Pago</span>
                    <mat-icon class="text-xl text-gray-500 group-hover:text-primary transition-colors">chevron_right</mat-icon>
                </a>

                <a [routerLink]="['/profile-user', 'history']" class="p-4 border-b border-gray-300 hover:border-primary transition-all duration-200 flex justify-between items-center group">
                    <span class="text-base font-medium">Historial</span>
                    <mat-icon class="text-xl text-gray-500 group-hover:text-primary transition-colors">chevron_right</mat-icon>
                </a>

                <button onclick="my_modal_5.showModal()" class="p-4 border-b border-gray-300 hover:border-primary transition-all duration-200 flex justify-between items-center group">
                    <span class="text-base font-medium">Créditos disponibles</span>
                    <mat-icon class="text-xl text-gray-500 group-hover:text-primary transition-colors">chevron_right</mat-icon>
                </button>

                <a [routerLink]="['/favorites']" class="p-4 border-b border-gray-300 hover:border-primary transition-all duration-200 flex justify-between items-center group">
                    <span class="text-base font-medium">Favoritos</span>
                    <mat-icon class="text-xl text-gray-500 group-hover:text-primary transition-colors">chevron_right</mat-icon>
                </a>

            </div>
        </section>
    }

} <!-- FIN DEL ELSE -->

</div>


<!-- Modal Créditos -->
<dialog id="my_modal_5" class="modal modal-bottom sm:modal-middle text-base-content">
    <div class="modal-box">
        <h3 class="text-lg font-bold">Tus Créditos Disponibles!</h3>
        <div class="bg-accent rounded-xl p-6 text-white text-center shadow-lg">
            <div class="text-sm font-light uppercase opacity-90 mb-1">Saldo Actual</div>
            <div class="text-5xl font-extrabold tracking-tight">
                {{ creditData.currentBalance }} {{ creditData.currency }}
            </div>
            <div class="mt-2 text-sm opacity-90">
                Última actualización: {{ now | date: 'shortDate' }}
            </div>
        </div>  
        <div class="space-y-3 pt-2">
            <div class="flex items-center gap-3">
                <mat-icon class="text-green-500">check_circle</mat-icon>
                <span class="text-sm">Usable en todas las compras de boletos.</span>
            </div>
            <div class="flex items-center gap-3">
                <mat-icon class="text-blue-500">info</mat-icon>
                <span class="text-sm">Los créditos no caducan.</span>
            </div>
        </div>
        <div class="modal-action">
            <form method="dialog">
                <button class="btn btn-ghost text-gray-600">Cerrar</button>
            </form>
        </div>
    </div>
</dialog>
