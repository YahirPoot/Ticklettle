
@if (ticketResource.isLoading()) {
        <!-- SHIMMER: estructura completa mientras carga -->
    <div class="pb-4 animate-pulse">
        <div class=" w-44"></div>
    </div>
    <div class="p-4 flex-1 flex items-start justify-center pt-8 md:pt-16 w-full">
        <article class="card w-full max-w-4xl shadow-xl rounded-2xl overflow-hidden bg-base-100 animate-pulse">
            <!-- header skeleton -->
            <div class="h-48 md:h-60 w-full bg-base-300"></div>

            <!-- body skeleton -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
            <!-- izquierda: QR skeleton -->
            <div class="flex flex-col items-center gap-4">
                <div class="bg-base-100 rounded-lg p-4 shadow-sm w-full flex items-center justify-center">
                <div class="w-44 h-44 bg-base-300 rounded"></div>
                </div>

                <div class="w-full max-w-xs text-center">
                <div class="h-4 bg-base-300 rounded mt-2"></div>
                <div class="h-4 bg-base-300 rounded mt-3"></div>
                <div class="mt-3 flex gap-2 justify-center">
                    <div class="h-9 w-36 bg-base-300 rounded"></div>
                    <div class="h-9 w-28 bg-base-300 rounded"></div>
                </div>
                </div>
            </div>

            <!-- derecha: detalles skeleton -->
            <div class="flex flex-col justify-between">
                <div>
                <div class="h-6 bg-base-300 rounded w-3/5"></div>
                <div class="h-4 bg-base-300 rounded w-1/2 mt-3"></div>

                <dl class="mt-4 grid grid-cols-1 gap-3 text-sm">
                    <div class="space-y-2">
                    <div class="h-4 bg-base-300 rounded w-full"></div>
                    <div class="h-4 bg-base-300 rounded w-5/6"></div>
                    <div class="h-4 bg-base-300 rounded w-2/3"></div>
                    </div>
                </dl>
                </div>

                <div class="mt-6 flex flex-col sm:flex-row sm:justify-end sm:items-center gap-3">
                <div class="h-9 w-28 bg-base-300 rounded"></div>
                <div class="h-9 w-20 bg-base-300 rounded"></div>
                </div>
            </div>
            </div>
        </article>
    </div>
} @else {
    <div class="w-full flex flex-col text-base-content">
        <div class="p-4">
            <h1 class="text-2xl font-semibold">Vista de Boleto</h1>
        </div>

        <!-- Ticket card -->
        <div class="p-4 flex-1 flex items-start justify-center">
            <article class="card w-full max-w-4xl shadow-xl rounded-2xl overflow-hidden bg-base-100">
            <!-- Header: imagen con overlay -->
            @if (ticketDetails?.event?.imageUrl) {
                <div class="relative h-48 md:h-60 w-full">
                <img
                    [src]="ticketDetails?.event?.imageUrl"
                    [alt]="ticketDetails?.event?.name"
                    class="w-full h-full object-cover"
                    decoding="async" loading="lazy"
                />
                <div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/40"></div>

                <div class="absolute left-6 bottom-4 text-white">
                    <h2 class="text-lg md:text-2xl font-bold leading-tight">
                    {{ ticketDetails?.event?.name }}
                    </h2>
                    <p class="text-sm opacity-90">
                    {{ ticketDetails?.event?.city }}, {{ ticketDetails?.event?.state }}
                    &nbsp;·&nbsp; {{ ticketDetails?.event?.dateTime | date:'medium' }}
                    </p>
                </div>

                <!-- status badge -->
                <span class="absolute right-4 top-4 inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium bg-white/90 text-black">
                    <mat-icon class="text-base">confirmation_number</mat-icon>
                    <span class="uppercase">{{ ticketDetails?.status || 'Activo' }}</span>
                </span>
                </div>
            } @else {
                <div class="h-48 md:h-60 bg-gradient-to-br from-accent/10 to-neutral/10 flex items-center justify-center">
                <h2 class="text-xl font-bold">{{ ticketDetails?.event?.name }}</h2>
                </div>
            }

            <!-- Body: QR + detalles -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
                <!-- Col izquierda: QR + código -->
                <div class="flex flex-col items-center gap-4">
                <div class="bg-white rounded-lg p-4 shadow-sm">
                    <qrcode
                    class="block"
                    [qrdata]="ticketDetails?.uniqueCode!"
                    [width]="220"
                    [errorCorrectionLevel]="'M'">
                    </qrcode>
                </div>

                <div class="w-full max-w-xs text-center">
                    <!-- <p class="text-xs text-muted uppercase">Código único</p>
                    <div class="mt-2 flex items-center justify-center gap-3">
                    <code class="px-3 py-2 bg-base-200 rounded-md font-mono text-sm truncate">{{ ticketDetails?.uniqueCode }}</code>
                    <button class="btn btn-ghost btn-sm p-2" (click)="copyCode()" aria-label="Copiar código">
                        <mat-icon>content_copy</mat-icon>
                    </button>
                    </div> -->

                    <div class="mt-3 flex gap-2 justify-center">
                    <!-- Si ya existe saveLink, usar <a> para permitir ctrl+click nativo.
                        Si no, usar handler que genera la URL (addToGoogleWallet) -->
                    @if (ticketDetails?.googleWalletSaveLink) {
                        <a
                        class="btn btn-ghost rounded-full p-0 btn-sm"
                        [href]="ticketDetails?.googleWalletSaveLink"
                        target="_blank"
                        rel="noopener noreferrer"
                        >
                            <img [src]="'assets/google-wallet/es419_add_to_google_wallet_wallet-button.png'" alt="Google Wallet" class="w-full h-full object-cover">
                        </a>
                    } @else {
                        <button
                        class="btn btn-outline btn-sm"
                        (click)="addToGoogleWallet($event)"
                        [disabled]="isAddingToWallet()"
                        >
                        Agregar a Google Wallet
                        </button>
                    }

                    <!-- <button class="btn btn-primary btn-sm" (click)="downloadTicketPdf()">
                        Descargar
                    </button> -->
                    </div>
                </div>
                </div>

                <!-- Col derecha: detalles del ticket -->
                <div class="flex flex-col justify-between">
                <div>
                    <h3 class="text-lg font-semibold">{{ ticketDetails?.type | titlecase }} - ${{ ticketDetails?.price }}</h3>
                    <p class="text-sm text-muted mt-2">{{ ticketDetails?.event?.location }} · {{ ticketDetails?.event?.city }}</p>

                    <dl class="mt-4 grid grid-cols-1 gap-2 text-sm">
                    <div>
                        <dt class="font-medium text-xs text-muted">Fecha</dt>
                        <dd>{{ ticketDetails?.event?.dateTime | date:'fullDate' }} · {{ ticketDetails?.event?.dateTime | date:'shortTime' }}</dd>
                    </div>

                    <div>
                        <dt class="font-medium text-xs text-muted">Tipo</dt>
                        <dd class="capitalize">{{ ticketDetails?.type }}</dd>
                    </div>

                    <div>
                        <dt class="font-medium text-xs text-muted">Comprado</dt>
                        <dd>{{ ticketDetails?.purchaseDate | date:'medium' }}</dd>
                    </div>

                    <div>
                        <dt class="font-medium text-xs text-muted">Evento ID</dt>
                        <dd>{{ ticketDetails?.event?.eventId }}</dd>
                    </div>
                    </dl>
                </div>

                <!-- acciones secundarias -->
                <div class="mt-6 flex flex-col sm:flex-row sm:justify-end sm:items-center gap-3">
                    <!-- <button class="btn btn-ghost btn-sm" (click)="shareTicket()">
                    <mat-icon>share</mat-icon>
                    <span class="ml-2">Compartir</span>
                    </button> -->

                    <a class="btn btn-ghost btn-sm" [routerLink]="['/detail-event', ticketDetails?.event?.eventId]">
                    <mat-icon>event</mat-icon>
                    <span class="ml-2">Ver evento</span>
                    </a>
                </div>
                </div>
            </div>
            </article>
        </div>
    </div>
}